<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIA Absensi</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  font-family:'Poppins',sans-serif;
  background:linear-gradient(160deg,#0f2027,#203a43,#2c5364);
  color:#fff;
  margin:0;
  padding:22px;
  min-height:100vh;
}
.container{max-width:420px;margin:auto}

.header{text-align:center;margin-bottom:24px}
.header h1{margin:0;font-size:30px;color:#03DAC5}
.version{font-size:12px;color:#9adfd7}
.datetime{font-size:13px;color:#cfd8dc;margin-top:6px}

.card{
  background:rgba(0,0,0,.35);
  padding:20px;
  border-radius:18px;
  margin-bottom:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}

.card h3{
  text-align:center;
  color:#03DAC5;
  margin-bottom:14px;
}

textarea{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  resize:none;
  min-height:90px;
  background:#1f2a33;
  color:#fff;
  font-size:14px;
}

textarea::placeholder{color:#9aa7ad}

button{
  width:100%;
  margin-top:12px;
  padding:14px;
  background:#03DAC5;
  border:none;
  border-radius:12px;
  font-weight:600;
  cursor:pointer;
}

.result{
  margin-top:14px;
  padding:14px;
  background:#1e2a32;
  border-radius:12px;
  word-break:break-all;
  font-size:14px;
}

.copy{
  display:block;
  margin-bottom:8px;
  font-size:12px;
  background:#03DAC5;
  color:#000;
  border:none;
  border-radius:8px;
  padding:6px 10px;
  cursor:pointer;
  width:fit-content;
}

.history-item{
  background:#1f2a33;
  padding:10px;
  border-radius:10px;
  margin-bottom:8px;
  font-size:13px;
  word-break:break-all;
}

.note{
  font-size:11px;
  color:#9aa7ad;
  text-align:center;
  margin-top:8px;
}

.footer{
  text-align:center;
  font-size:13px;
  color:#aaa;
  margin-top:28px;
}
.footer a{color:#03DAC5;text-decoration:none}
</style>

<script>
function updateDateTime(){
  const n=new Date();
  document.getElementById("dt").innerText =
    n.toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})
    +" â€¢ "+n.toLocaleTimeString("id-ID");
}
setInterval(updateDateTime,1000);

function copyText(id){
  navigator.clipboard.writeText(document.getElementById(id).innerText);
}

/* ===== RIWAYAT LOKAL ===== */
function saveHistory(value){
  let h=JSON.parse(localStorage.getItem("history"))||[];
  h.unshift(value);
  if(h.length>5) h.pop();
  localStorage.setItem("history",JSON.stringify(h));
}

function loadHistory(){
  let h=JSON.parse(localStorage.getItem("history"))||[];
  let el=document.getElementById("history");
  el.innerHTML = h.length
    ? h.map(v=>`<div class="history-item">${v}</div>`).join("")
    : `<div class="note">Belum ada riwayat</div>`;
}
</script>
</head>

<body onload="updateDateTime();loadHistory()">

<div class="container">

<!-- HEADER -->
<div class="header">
  <h1>SIA Absensi</h1>
  <div class="version">Version 1.6.9+</div>
  <div id="dt" class="datetime"></div>
</div>

<!-- DEKRIPSI -->
<div class="card">
<h3>Dekripsi Absen</h3>

<form method="POST" action="/decrypt">
  <textarea name="text" placeholder="Pastekan kode absen di sini..." required></textarea>
  <button>Dekripsi</button>
</form>

<% if (decrypted) { %>
<script>saveHistory("<%= decrypted %>")</script>
<div class="result">
  <button class="copy" onclick="copyText('dec')">Copy</button>
  <div id="dec"><%= decrypted %></div>
</div>
<% } %>

<div class="note">
Format: KodeMatkul,Pertemuan,Tanggal,JamMulai-JamSelesai
</div>
</div>

<!-- ENKRIPSI -->
<div class="card">
<h3>Enkripsi Absen</h3>

<form method="POST" action="/encrypt">
  <textarea name="text" placeholder="Paste dan Edit hasil Deskripsi di sini..." required></textarea>
  <button>Enkripsi</button>
</form>

<% if (encrypted) { %>
<div class="result">
  <button class="copy" onclick="copyText('enc')">Copy</button>
  <div id="enc"><%= encrypted %></div>
</div>
<% } %>
</div>

<!-- RIWAYAT (PALING BAWAH) -->
<div class="card">
<h3>Riwayat Terakhir</h3>
<div id="history"></div>
<div class="note">Data hanya tersimpan di perangkat</div>
</div>

<div class="footer">
Created by <a href="https://github.com/xzeeeeen">_xzeeeeen</a>
</div>

</div>
</body>
</html>
